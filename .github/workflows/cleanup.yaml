name: Daily Repository Cleanup

on:
  schedule:
    # å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤© 20:00 (UTC) æ‰§è¡Œ
    # ä¹Ÿå°±æ˜¯åŒ—äº¬æ—¶é—´æ¯å¤© 04:00 è¿è¡Œ
    - cron: '0 20 * * *'

  # å¯æ‰‹åŠ¨è§¦å‘ï¼Œæ–¹ä¾¿æµ‹è¯•
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest

    # å…è®¸å·¥ä½œæµæ¨é€æ›´æ”¹
    permissions:
      contents: write

    steps:
      - name: 1. ç­¾å‡º (Checkout) ä»“åº“ä»£ç 
        uses: actions/checkout@v4

      - name: 2. é…ç½® Git ç”¨æˆ·
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: 3. æ‰§è¡Œæ¸…ç†æ“ä½œï¼ˆâš ï¸è¯·è°¨æ…ï¼‰
        run: |
          echo "å¼€å§‹æ¸…ç†æ–‡ä»¶..."
          # å¯ç”¨ extglob æ”¯æŒ !(...) æ¨¡å¼
          shopt -s extglob
          # å¦‚æœæƒ³åŒæ—¶åŒ¹é…åˆ é™¤éšè—æ–‡ä»¶ï¼ˆä¾‹å¦‚ .envã€.DS_Storeï¼‰ï¼Œè¯·å–æ¶ˆä¸‹ä¸€è¡Œæ³¨é‡Šï¼ˆå±é™©ï¼‰
          # shopt -s dotglob

          # åªä¿ç•™ README.md, .git (ç‰ˆæœ¬æ§åˆ¶), .github (Action è„šæœ¬)
          # ä¸è¦å»æ‰‹åŠ¨åˆ  .github ä¸‹é¢çš„ä¸œè¥¿ï¼Œå¦åˆ™è„šæœ¬ä¼šè‡ªæ€
          rm -rf !(README.md|.git|.github)


          echo "âœ… æ¸…ç†å®Œæˆ"

      - name: 4. æäº¤å¹¶æ¨é€å˜æ›´
        run: |
          # æš‚å­˜æ‰€æœ‰ä¿®æ”¹ï¼ˆåŒ…æ‹¬åˆ é™¤ï¼‰
          git add -A

          # æ£€æŸ¥æ˜¯å¦æœ‰å·²æš‚å­˜å˜æ›´
          if git diff --staged --quiet; then
            echo "ğŸ“ ä»“åº“å·²æ˜¯å¹²å‡€çŠ¶æ€ï¼Œæ— éœ€æäº¤"
          else
            echo "ğŸ“ æ£€æµ‹åˆ°å˜æ›´ï¼Œå‡†å¤‡æäº¤å¹¶æ¨é€..."
            git commit -m "chore: æ¯æ—¥è‡ªåŠ¨æ¸…ç†ä»“åº“æ–‡ä»¶" || echo "âš ï¸ æ²¡æœ‰å¯æäº¤çš„æ”¹åŠ¨æˆ–æäº¤å¤±è´¥"
            git push || echo "âš ï¸ æ¨é€å¤±è´¥ï¼Œå¯èƒ½å› åˆ†æ”¯ä¿æŠ¤æˆ–æƒé™é™åˆ¶"
          fi
